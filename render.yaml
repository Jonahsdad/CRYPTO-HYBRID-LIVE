services:
- type: web
  name: crypto-hybrid-live
  env: python

  envVars:
  - key: PYTHON_VERSION
    value: 3.12.6
  - key: STREAMLIT_SERVER_HEADLESS
    value: "true"
  - key: STREAMLIT_BROWSER_GATHER_USAGE_STATS
    value: "false"
  - key: STREAMLIT_SERVER_ENABLECORS
    value: "false"
  - key: STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION
    value: "false"

  buildCommand: |
    echo "ðŸ§¹ Clearing ALL cache and old layers..."
    rm -rf ~/.cache/pip || true
    rm -rf /opt/render/project/src/.render-build-cache || true

    echo "ðŸ“¦ Installing requirements from scratch..."
    pip install --upgrade pip setuptools wheel --no-cache-dir
    pip install -r requirements.txt --no-cache-dir

  startCommand: |
    echo "âœ… Starting Streamlit App..."
    streamlit run app_v3/app.py \
      --server.port $PORT \
      --server.address 0.0.0.0 \
      --server.headless true \
      --server.enableCORS false \
      --server.enableXsrfProtection false
